<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Linear Regression &mdash; Duke NGS Course (Summer 2015) 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Duke NGS Course (Summer 2015) 1.0 documentation" href="index.html" />
    <link rel="next" title="Using R for supervised learning" href="SupervisedLearning.html" />
    <link rel="prev" title="Functional Programming" href="FunctionalProgramming.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Duke NGS Course (Summer 2015)</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="VMsAtDuke.html">How to Claim and Access Your Virtual Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicRinJupyterAndRstudio.html">Basic R in the Jupyter Notebook and RStudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="IntroductionToR.html">Introduction to R</a></li>
<li class="toctree-l1"><a class="reference internal" href="PreparingDataForAnalysis.html">Preparing Data for Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkingWithData.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="GroupingandAggregation.html">Grouping and Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hypothesistestingandpowercalcuations.html">Hypothesis Testing and Power Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Probabilitydistributionsandrandomnumbergeneration.html">Probability distributions and Random Number Genereation</a></li>
<li class="toctree-l1"><a class="reference internal" href="WritingcustomfunctionsinRSolutions.html">Writing Custom Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="FunctionalProgramming.html">Functional Programming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupervisedLearning.html">Using R for supervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="SupervisedLearningWhatCouldGoWrong.html">Supervised Learning Continued - What Could Go Wrong?</a></li>
<li class="toctree-l1"><a class="reference internal" href="UnsupervisedLearning.html">Unsupervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="UnsupervisedLearningAndNGS.html">Unsupervised Learning and NGS</a></li>
<li class="toctree-l1"><a class="reference internal" href="MultipleTesting.html">Multiple Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CountModels.html">Counting Models/Discrete Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="LogisticRegression.html">Generalized Linear Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallPackages.html">Installing Graphics Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="BaseGraphics.html">Base Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="MiscGraphics.html">Plotting Graphcs and Heatmpas</a></li>
<li class="toctree-l1"><a class="reference internal" href="BaseGraphicsGGPlotComparison.html">Introdcution to <code class="docutils literal"><span class="pre">ggplot2</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="GGPlot2Graphics.html">More <code class="docutils literal"><span class="pre">ggplot2</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="PracticeONE-Solutions.html">Practice ONE</a></li>
<li class="toctree-l1"><a class="reference internal" href="PracticeTWOSolutions.html">Practice TWO</a></li>
<li class="toctree-l1"><a class="reference internal" href="PracticeTHREESolutions.html">Practice THREE</a></li>
<li class="toctree-l1"><a class="reference internal" href="PracticeFOURSolutions.html">Practice FOUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="DESeq2Notebook.html">Introduction to DESeq2</a></li>
<li class="toctree-l1"><a class="reference internal" href="DESeq2NotebookFromMatrix.html">Import count data using basic tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installing R, RStudio and IPython notebook with the R kernel</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Linear Regression</a><ul>
<li><a class="reference internal" href="#simple-linear-models">Simple Linear Models</a></li>
<li><a class="reference internal" href="#discussion">Discussion</a><ul>
<li><a class="reference internal" href="#look-at-oj-and-tooth-growth">Look at OJ and Tooth Growth</a></li>
</ul>
</li>
<li><a class="reference internal" href="#r-formula-syntax">R Formula Syntax</a><ul>
<li><a class="reference internal" href="#work">Work!</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rails-example">Rails Example</a></li>
<li><a class="reference internal" href="#simulation">Simulation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="FunctionalProgramming.html" title="Previous Chapter: Functional Programming"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Functional Pr...</span>
    </a>
  </li>
  <li>
    <a href="SupervisedLearning.html" title="Next Chapter: Using R for supervised learning"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Using R for s... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/RFormulasAndStatisticalModeling.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="linear-regression">
<h1>Linear Regression<a class="headerlink" href="#linear-regression" title="Permalink to this headline">¶</a></h1>
<p>A major goal of this morning&#8217;s lecture was to introduce the idea of
intra-subject variability and how it affects the modeling of a
particular data set. We will begin by reviewing (briefly) simple linear
models, and we&#8217;ll discuss how to do such a fit in R. Then, we will look
more closely at the Rails example from this morning.</p>
<div class="section" id="simple-linear-models">
<h2>Simple Linear Models<a class="headerlink" href="#simple-linear-models" title="Permalink to this headline">¶</a></h2>
<p>A simple linear model is of the form</p>
<div class="math">
\[y_i = \alpha + \beta x_i + \epsilon_i\]</div>
<p>The goal of a linear regression is to find the line</p>
<div class="math">
\[y = \alpha +\beta x\]</div>
<p>that best fits the data. I.e. we find the line such that the sum of the
squared errors is minimized. A key assumption in such a model is that
the errors follow a standard normal distribution. This is important,
because when this assumption is invalid, applying the standard
confidence interval calculation for the slope <span class="math">\(\beta\)</span> will be
wrong.</p>
<p>We will use a sample data set from R to illustrate a simple linear
regression.</p>
<p># load the data set
data(ToothGrowth)</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Let&#39;s see what it looks like:</span>
<span class="n">ToothGrowth</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>    len supp dose
1   4.2   VC  0.5
2  11.5   VC  0.5
3   7.3   VC  0.5
4   5.8   VC  0.5
5   6.4   VC  0.5
6  10.0   VC  0.5
7  11.2   VC  0.5
8  11.2   VC  0.5
9   5.2   VC  0.5
10  7.0   VC  0.5
11 16.5   VC  1.0
12 16.5   VC  1.0
13 15.2   VC  1.0
14 17.3   VC  1.0
15 22.5   VC  1.0
16 17.3   VC  1.0
17 13.6   VC  1.0
18 14.5   VC  1.0
19 18.8   VC  1.0
20 15.5   VC  1.0
21 23.6   VC  2.0
22 18.5   VC  2.0
23 33.9   VC  2.0
24 25.5   VC  2.0
25 26.4   VC  2.0
26 32.5   VC  2.0
27 26.7   VC  2.0
28 21.5   VC  2.0
29 23.3   VC  2.0
30 29.5   VC  2.0
31 15.2   OJ  0.5
32 21.5   OJ  0.5
33 17.6   OJ  0.5
34  9.7   OJ  0.5
35 14.5   OJ  0.5
36 10.0   OJ  0.5
37  8.2   OJ  0.5
38  9.4   OJ  0.5
39 16.5   OJ  0.5
40  9.7   OJ  0.5
41 19.7   OJ  1.0
42 23.3   OJ  1.0
43 23.6   OJ  1.0
44 26.4   OJ  1.0
45 20.0   OJ  1.0
46 25.2   OJ  1.0
47 25.8   OJ  1.0
48 21.2   OJ  1.0
49 14.5   OJ  1.0
50 27.3   OJ  1.0
51 25.5   OJ  2.0
52 26.4   OJ  2.0
53 22.4   OJ  2.0
54 24.5   OJ  2.0
55 24.8   OJ  2.0
56 30.9   OJ  2.0
57 26.4   OJ  2.0
58 27.3   OJ  2.0
59 29.4   OJ  2.0
60 23.0   OJ  2.0
</pre></div>
</div>
<p>These data are the results of an experiment where 60 Guinea Pigs were
divided in to 6 groups and then were given a specific dose of either
vitamin C or orange juice over a period of time, and then their tooth
length was measured. We&#8217;ll do two separated fits: one for vitamin C and
one for OJ.</p>
<div class="code python highlight-python"><div class="highlight"><pre># Let&#39;s see a scatter plot
with(subset(ToothGrowth,  supp == &quot;VC&quot;), plot(dose, len))
title(main=&quot;Growth of Tooth vs Dose of Vitamin C&quot;)
</pre></div>
</div>
<img alt="_images/RFormulasAndStatisticalModeling_7_0.png" src="_images/RFormulasAndStatisticalModeling_7_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre>with(subset(ToothGrowth,  supp == &quot;OJ&quot;), plot(dose, len))
title(main=&quot;Growth of Tooth vs Dose of OJ&quot;)
</pre></div>
</div>
<img alt="_images/RFormulasAndStatisticalModeling_8_0.png" src="_images/RFormulasAndStatisticalModeling_8_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre># Fit for vitamin C
fit.tooth.VC&lt;-lm(ToothGrowth$len ~ ToothGrowth$dose,subset=(ToothGrowth$supp==&quot;VC&quot;))
summary(fit.tooth.VC)
</pre></div>
</div>
<pre class="literal-block">
Call:
lm(formula = ToothGrowth$len ~ ToothGrowth$dose, subset = (ToothGrowth$supp ==
    &quot;VC&quot;))

Residuals:
    Min      1Q  Median      3Q     Max
-8.2264 -2.6029  0.0814  2.2288  7.4893

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)         3.295      1.427   2.309   0.0285 *
ToothGrowth$dose   11.716      1.079  10.860 1.51e-11 <strong>*
---
Signif. codes:  0 ‘*</strong>’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 3.685 on 28 degrees of freedom
Multiple R-squared:  0.8082,        Adjusted R-squared:  0.8013
F-statistic: 117.9 on 1 and 28 DF,  p-value: 1.509e-11
</pre>
<div class="code python highlight-python"><div class="highlight"><pre># Fit for vitamin C
fit.tooth.VC&lt;-lm(len ~ dose, subset=(supp==&quot;VC&quot;), data=ToothGrowth)
summary(fit.tooth.VC)
</pre></div>
</div>
<pre class="literal-block">
Call:
lm(formula = len ~ dose, data = ToothGrowth, subset = (supp ==
    &quot;VC&quot;))

Residuals:
    Min      1Q  Median      3Q     Max
-8.2264 -2.6029  0.0814  2.2288  7.4893

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)    3.295      1.427   2.309   0.0285 *
dose          11.716      1.079  10.860 1.51e-11 <strong>*
---
Signif. codes:  0 ‘*</strong>’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 3.685 on 28 degrees of freedom
Multiple R-squared:  0.8082,        Adjusted R-squared:  0.8013
F-statistic: 117.9 on 1 and 28 DF,  p-value: 1.509e-11
</pre>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>What is the biological hypothesis?</li>
<li>What is the statistical hypothesis?</li>
<li>How do we test the statistical hypothesis?</li>
<li>What is your conclusion?</li>
</ul>
<div class="section" id="look-at-oj-and-tooth-growth">
<h3>Look at OJ and Tooth Growth<a class="headerlink" href="#look-at-oj-and-tooth-growth" title="Permalink to this headline">¶</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre># Fit for OJ
fit.tooth.OJ&lt;-lm(ToothGrowth$len ~ ToothGrowth$dose,subset=(ToothGrowth$supp==&quot;OJ&quot;))
summary(fit.tooth.OJ)
</pre></div>
</div>
<p>Note that the <code class="docutils literal"><span class="pre">lm</span></code> function (for linear model) takes arguments in a
specific format:</p>
<div class="math">
\[y\_values \sim  x\_values\]</div>
<p>Or more formally stated: Dependent Variable ~ Independent Variable</p>
</div>
</div>
<div class="section" id="r-formula-syntax">
<h2>R Formula Syntax<a class="headerlink" href="#r-formula-syntax" title="Permalink to this headline">¶</a></h2>
<p>A more complicated linear model might include more than one main effect
and/or interaction terms such as:</p>
<div class="math">
\[y = \alpha + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_1 x_2 +\epsilon\]</div>
<p>Below is a table of R formula syntax and the corresponding model. There
are others, but that is a topic for more advanced study.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Syntax</th>
<th class="head">Model</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><span class="math">\(x_1 + x_2 \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\)</span></td>
<td><span class="math">\(y = \alpha + \beta_1 x_1 + \beta_2 x_2 +\epsilon\)</span></td>
</tr>
<tr class="row-odd"><td><span class="math">\(x_1:x_1\)</span></td>
<td><span class="math">\(y = \alpha + \beta x_1 x_2 +\epsilon \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\)</span></td>
</tr>
<tr class="row-even"><td><span class="math">\(x_1 * x_2\)</span></td>
<td><span class="math">\(y = \alpha + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_1 x_2 +\epsilon \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\)</span></td>
</tr>
<tr class="row-odd"><td><span class="math">\(x_1 * x_2 *x_3\)</span></td>
<td><span class="math">\(y = \alpha + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 +\beta_4 x_1 x_2 +\beta_5 x_1 x_3 + \beta_6 x_2 x_3 + \beta_7 x_1 x_2 x_3 +\epsilon\)</span></td>
</tr>
<tr class="row-even"><td><span class="math">\((x_1 + x_2 + x_3)^2\)</span></td>
<td><span class="math">\(y = \alpha + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_3 +\beta_4 x_1 x_2 +\beta_5 x_1 x_3 + \beta_6 x_2 x_3 +\epsilon\)</span></td>
</tr>
</tbody>
</table>
<div class="section" id="work">
<h3>Work!<a class="headerlink" href="#work" title="Permalink to this headline">¶</a></h3>
<p>Load the R data set called &#8220;mtcars&#8221;.</p>
<ul class="simple">
<li>Perform a linear regression on mpg using cyl and hp as main effects.</li>
<li>Add wt (weight) as a third main effect.</li>
<li>Add interaction terms for hp and weight</li>
</ul>
</div>
</div>
<div class="section" id="rails-example">
<h2>Rails Example<a class="headerlink" href="#rails-example" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Rails example</span>

<span class="c"># Just loading some library functions</span>
<span class="n">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>

<span class="c"># Get the dataset (it is part of R)</span>
<span class="n">data</span><span class="p">(</span><span class="n">Rail</span><span class="p">)</span>

<span class="c"># Look at the data</span>
<span class="n">Rail</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>#Plot the data

xyplot(travel~Rail,data=Rail,ylab=&quot;Zero-force travel time (nano-seconds)&quot;)
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># Linear Model ignoring random effect

fit.rails.simple&lt;-lm(travel~1,data=Rail)
summary(fit.rails.simple)
res&lt;-fit.rails.simple$residuals
qqnorm(res);qqline(res)
</pre></div>
</div>
<p>The above plot is called a &#8216;QQ plot&#8217;. The straight line represents the
quantiles of the normal distribution, while the dots are the quantiles
of the residuals. If the errors were normally distributed, the dots
would be close to or on the line.</p>
<p>Note: In this example, we are fitting a one-parameter model, i.e.</p>
<div class="math">
\[y_i = \alpha + \epsilon_i\]</div>
<p>Where <span class="math">\(\alpha\)</span> is the mean travel time along a rail.</p>
<div class="code python highlight-python"><div class="highlight"><pre>mean(Rail$travel)
sd(Rail$travel)
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># Linear Model incorporating random effect
fit.rails.mm&lt;-lme(travel~1,random=~1|Rail,data=Rail)
summary(fit.rails.mm)
res&lt;-fit.rails.mm$residuals
</pre></div>
</div>
</div>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre>sim.ranef=function(nk,n,se,sb,verbose=FALSE)
    {
        # n exp units with nk replicates each
        N=n*nk

        # generate error from normal distribution with zero mean and variance se
        e=rnorm(N,0,se)

        # generate random effect from normal with mean zero and variance sb
        # here we get n different samples from the normal - but replicate those nk times
        b=rep(rnorm(n,0,sb),each=nk)

        # assigning a label to each n sample (eg. each rail), repeat nk times
        id=rep(1:n,each=nk)

        # Simulated output value
        y=0+e+b

        # create a data frame with the id, errors and outcome
        dat=data.frame(id,b,e,y)


        # fit both models: standard linear model (lm) and linear mixed effects (lme)
        mod0=summary(lm(y~1,data=dat))
        mod1=summary(lme(y~1,random=~1|id,data=dat))

        # extract the pvalues
        pval0=mod0$coef[&quot;(Intercept)&quot;,&quot;Pr(&gt;|t|)&quot;]  #each package returns a slightly different data frame
        pval1=mod1$tTable[&quot;(Intercept)&quot;,&quot;p-value&quot;]

    # Just changing output based on options passed to the function.
       if(verbose)
            {
                out=list(dat,mod0,mod1) # This is a list data type. Basically, you can put anything into a list.
            }
        else
            {
                out=c(pval0,pval1) # Output only the p-values from the two models.
            }
        out
    }
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># run the first simulation</span>

<span class="nb">set</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">210</span><span class="p">)</span>

<span class="c"># simulate 3 measurements on each of 6 subjects</span>

<span class="n">ex1</span><span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">ranef</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="c">#print the simulated data set - note that it is stored in element 1 of a list.</span>
<span class="n">ex1</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># plot the simultation data using xyplot (from the lattice package)
xyplot(y~id,data=ex1[[1]])

# print the output from the two fits.

ex1[[2]]
ex1[[3]]
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c">#Run the simulation 1000 times</span>
<span class="nb">set</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">210</span><span class="p">)</span>
<span class="n">B</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">res</span><span class="o">=</span><span class="n">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">sim</span><span class="o">.</span><span class="n">ranef</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">FALSE</span><span class="p">))</span> <span class="c">#Note that verbose=FALSE means that the simulation will</span>
                                                                 <span class="c"># output only p-values</span>

<span class="c"># Compute the type I error rates</span>
<span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">qqplot</span><span class="p">(</span><span class="n">qunif</span><span class="p">(</span><span class="n">ppoints</span><span class="p">(</span><span class="mi">500</span><span class="p">)),</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,],</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Uniform Distribution&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lm&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qqplot</span><span class="p">(</span><span class="n">qunif</span><span class="p">(</span><span class="n">ppoints</span><span class="p">(</span><span class="mi">500</span><span class="p">)),</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,],</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Uniform Distribution&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lme&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,],</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,],</span><span class="n">pch</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;lm&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lme&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Increase Sample size</span>
<span class="n">B</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">res</span><span class="o">=</span><span class="n">replicate</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">sim</span><span class="o">.</span><span class="n">ranef</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="n">FALSE</span><span class="p">))</span>
<span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">)</span>

<span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">)</span>


<span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">qqplot</span><span class="p">(</span><span class="n">qunif</span><span class="p">(</span><span class="n">ppoints</span><span class="p">(</span><span class="mi">500</span><span class="p">)),</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,],</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Uniform Distribution&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lm&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">qqplot</span><span class="p">(</span><span class="n">qunif</span><span class="p">(</span><span class="n">ppoints</span><span class="p">(</span><span class="mi">500</span><span class="p">)),</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,],</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Uniform Distribution&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lme&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,],</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,],</span><span class="n">pch</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span><span class="n">cex</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;lm&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;lme&quot;</span><span class="p">)</span>
<span class="n">abline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># Clustering Effect on Two sample problem
sim.twosample.clustered=function(nk,n,se,sb,verbose=FALSE)
    {
        N=n*nk
        e0=rnorm(N,0,se)
        e1=rnorm(N,0,se)
        b0=rep(rnorm(n,0,sb),each=nk)
        b1=rep(rnorm(n,0,sb),each=nk)
        y0=e0+b0
        y1=e1+b1
        t.test(y0,y1)$p.value
    }

set.seed(2314)
B=1000
# Simulate with no clustering effect (sb=0)
pval0=replicate(B,sim.twosample.clustered(3,10,0.25,0))
# Simulate with no clustering effect (sb&gt;0)
pval1=replicate(B,sim.twosample.clustered(3,10,0.25,0.5))
rm(B)

mean(pval0&lt;0.05)
mean(pval1&lt;0.05)
par(mfrow=c(1,2))
qqplot(qunif(ppoints(500)), pval0,cex=0.1,xlab=&quot;Uniform Distribution&quot;)
abline(0,1)
qqplot(qunif(ppoints(500)), pval1,cex=0.1,xlab=&quot;Uniform Distribution&quot;)
abline(0,1)
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright Public Domain.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>